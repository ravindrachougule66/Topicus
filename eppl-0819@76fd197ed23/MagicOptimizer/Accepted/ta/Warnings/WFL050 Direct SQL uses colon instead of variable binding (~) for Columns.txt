Program ISN,Program #,Task,Name,SQL
1565524955,,".3.1","SetResponseTr","select i.trai_tr_volgnummer,         min(i.trai_tr_account_code)from tap_tr_rel_account_info iinner join transactions t   on t.tr_volgnummer = i.trai_tr_volgnummerwhere i.trai_tr_re_id = ~1 and       i.trai_tr_volgnummer >= ~2 and      t.tr_mut_gemaakt = 'J'       :3group by i.trai_tr_volgnummer, i.trai_tr_re_idorder by i.trai_tr_re_id, i.trai_tr_volgnummerfetch first ~4 rows only"
1140851592,,".2.3","UnbookedTransactionGeneral","select t.tr_volgnummer,       t.tr_transnummer,       t.tr_rel1,       t.tr_rel2,       t.tr_rel1_rek1,       t.tr_rel1_rek2,       t.tr_rel1_rek2_munts,       t.tr_vruchtrelatie,       t.tr_prijs_tr_mntsrt,       t.tr_trans_munts,       b.be_aantal_cijfers_display,       b.be_bi_nummer,	   b.be_prijs_factor,       t.tr_aantal,       t.tr_transdatum,       t.tr_exerciseprijs,       t.tr_expiratiedatum,       t.tr_optietype,       t.tr_symbool,       t.tr_context_enum,       t.tr_mut_gemaakt,       t.tr_indicatie,        t.tr_mutatiecode,       c.cl_naam1       /* Use this query for not or incomplete transactions and no account-filter applied.Use Unbooked relAccountInfo when an account filter is applied.*/from  tv_transactions_in_progress trip inner join transactions t on t.tr_volgnummer = trip.trip_tr_volgnummer inner join beleggingsinstrument b on t.tr_symbool = b.be_symbool      and t.tr_optietype = b.be_optietype      and t.tr_expiratiedatum = b.be_expiratiedatum      and t.tr_exerciseprijs = b.be_exerciseprijsinner join clienten c on c.cl_nummer =  t.tr_rel1 :21 -- inner join transorin_orderorin_vw tov on tov.transaction_orin_id = t.tr_orin_idwhere 1=1      and trip.trip_tr_volgnummer <= ~1       and (:2=0 or (t.tr_boekdatum between ~3 and ~4))      and (:5=0 or (t.tr_transdatum between ~6 and ~7))      :8 -- tr_indication in ('K'...'O-G'      and (:9=0 or (t.tr_ordernr_ordsubnr between ~10 and ~11))       and (:12=0 or trip.trip_tr_be_volgnummer = ~13)      and (:14 = 0 or (trip.trip_tr_terminalnummer = ~15))      and (:16=0 or (t.tr_context_enum = ~17))      and (:18=0 or (t.tr_mutatiecode = ~19))      and ((:20 = 0 and trip_tr_status = 0) or trip.trip_tr_status > 0)      :22 -- and tov.order_orin_id = :OrderOringId	  order by trip.trip_tr_volgnummer descfetch first ~23 rows only	"
1140851592,,".2.4","UnbookedTransactionAccount","select distinct t.tr_volgnummer,       t.tr_transnummer,       t.tr_rel1,       t.tr_rel1_rek1,       t.tr_rel1_rek2,       t.tr_rel1_rek2_munts,       t.tr_prijs_tr_mntsrt,       t.tr_trans_munts,       b.be_aantal_cijfers_display,       b.be_bi_nummer,	   b.be_prijs_factor,       t.tr_aantal,       t.tr_transdatum,       t.tr_exerciseprijs,       t.tr_expiratiedatum,       t.tr_optietype,       t.tr_symbool,       t.tr_context_enum,       t.tr_mut_gemaakt,       t.tr_indicatie,        t.tr_mutatiecode,       c.cl_naam1       /* Use this query for not or incomplete transactions and no account-filter applied.Use Unbooked relAccountInfo when an account filter is applied.*/from tap_tr_rel_account_info traiinner join tv_transactions_in_progress trip on trip.trip_tr_volgnummer = trai.trai_tr_volgnummerinner join transactions t on t.tr_volgnummer = trip.trip_tr_volgnummer inner join beleggingsinstrument b on t.tr_symbool = b.be_symbool      and t.tr_optietype = b.be_optietype      and t.tr_expiratiedatum = b.be_expiratiedatum      and t.tr_exerciseprijs = b.be_exerciseprijsinner join clienten c on c.cl_nummer =  t.tr_rel1 :25 -- inner join transorin_orderorin_vw tov on tov.transaction_orin_id = t.tr_orin_id:27 -- inner join tbv pensioenfondswhere 1=1      and trai.trai_tr_volgnummer <= ~1       and (:2=0 or trai_tr_re_id = ~3)      and (:4=0 or trai.trai_tr_cl_id=~5)      and (:6=0 or (t.tr_boekdatum between ~7 and ~8))      and (:9=0 or (t.tr_transdatum between ~10 and ~11))      :12 -- tr_indication in ('K'...'O-G'      and (:13=0 or (t.tr_ordernr_ordsubnr between ~14 and ~15))       and (:16=0 or trip.trip_tr_be_volgnummer = ~17)      and (:18 = 0 or (trip.trip_tr_terminalnummer = ~19))      and (:20=0 or (t.tr_context_enum = ~21))      and (:22=0 or (t.tr_mutatiecode = ~23))      and ((:24 = 0 and trip_tr_status = 0) or trip.trip_tr_status > 0)      :26 -- and tov.order_orin_id = :OrderOringId      :28 -- and e.object_ei = 'PENSFUND' and e.ext_id = :ExternalIdorder by trai.trai_tr_volgnummer descfetch first ~29 rows only"
1140851592,,".2.5","BookedTransactionGeneral","select t.tr_volgnummer,       t.tr_transnummer,       t.tr_rel1,       t.tr_rel2,       t.tr_rel1_rek1,       t.tr_rel1_rek2,       t.tr_rel1_rek2_munts,       t.tr_vruchtrelatie,       t.tr_prijs_tr_mntsrt,       t.tr_trans_munts,       b.be_aantal_cijfers_display,       b.be_bi_nummer,	   b.be_prijs_factor,       t.tr_aantal,       t.tr_transdatum,       t.tr_exerciseprijs,       t.tr_expiratiedatum,       t.tr_optietype,       t.tr_symbool,       t.tr_context_enum,       t.tr_mut_gemaakt,       t.tr_indicatie,        t.tr_mutatiecode,       c.cl_naam1       /* Use this query for booked  transactions and no account-filter applied.Use Booked relAccountInfo when an account filter is applied.*/from  transactions tinner join beleggingsinstrument b on t.tr_symbool = b.be_symbool      and t.tr_optietype = b.be_optietype      and t.tr_expiratiedatum = b.be_expiratiedatum      and t.tr_exerciseprijs = b.be_exerciseprijsinner join clienten c on c.cl_nummer =  t.tr_rel1 :23 -- inner join transorin_orderorin_vw tov on tov.transaction_orin_id = t.tr_orin_idwhere 1=1      and t.tr_volgnummer <= ~1       and (:2=0 or (t.tr_boekdatum between ~3 and ~4))      and (:5=0 or (t.tr_transdatum between ~6 and ~7))      and (:8=0 or (t.tr_transnummer between ~9 and ~10))      :11 -- tr_indication in ('K'...'O-G'      and (:12=0 or (t.tr_ordernr_ordsubnr between ~13 and ~14))       and (:15=0 or b.be_volgnummer = ~16)      and (:17=0 or (t.tr_context_enum = ~18))      and (:19=0 or (t.tr_mutatiecode = ~20))      and (:21=0 or (t.tr_mut_gemaakt = ~22))      :24 -- and tov.order_orin_id = :OrderOringIdorder by t.tr_volgnummer descfetch first ~25 rows only"
1140851592,,".2.6","BookedTransactionAccount","select distinct t.tr_volgnummer,       t.tr_transnummer,       t.tr_rel1,       t.tr_rel1_rek1,       t.tr_rel1_rek2,       t.tr_rel1_rek2_munts,       t.tr_prijs_tr_mntsrt,       t.tr_trans_munts,       b.be_aantal_cijfers_display,       b.be_bi_nummer,	   b.be_prijs_factor,       t.tr_aantal,       t.tr_transdatum,       t.tr_exerciseprijs,       t.tr_expiratiedatum,       t.tr_optietype,       t.tr_symbool,       t.tr_context_enum,       t.tr_mut_gemaakt,       t.tr_indicatie,        t.tr_mutatiecode,       c.cl_naam1       /* Use this query for completely booked transactions with account-filter applied.*/from tap_tr_rel_account_info traiinner join transactions t on t.tr_volgnummer = trai.trai_tr_volgnummer inner join beleggingsinstrument b on t.tr_symbool = b.be_symbool      and t.tr_optietype = b.be_optietype      and t.tr_expiratiedatum = b.be_expiratiedatum      and t.tr_exerciseprijs = b.be_exerciseprijsinner join clienten c on c.cl_nummer =  t.tr_rel1 :27 -- inner join transorin_orderorin_vw tov on tov.transaction_orin_id = t.tr_orin_id:29 -- inner join tbv pensioenfondswhere 1=1      and trai.trai_tr_volgnummer <= ~1       and (:2=0 or trai_tr_re_id = ~3)      and (:4=0 or trai.trai_tr_cl_id=~5)      and (:6=0 or (t.tr_boekdatum between ~7 and ~8))      and (:9=0 or (t.tr_transdatum between ~10 and ~11))      and (:12=0 or (t.tr_transnummer between ~13 and ~14))      :15 -- tr_indication in ('K'...'O-G'      and (:16=0 or (t.tr_ordernr_ordsubnr between ~17 and ~18))       and (:19=0 or  b.be_volgnummer = ~20)      and (:21=0 or (t.tr_context_enum = ~22))      and (:23=0 or (t.tr_mutatiecode = ~24))    and (:25=0 or (t.tr_mut_gemaakt = ~26))      :28 -- and tov.order_orin_id = :OrderOringId      :30 -- and e.object_ei = 'PENSFUND' and e.ext_id = :ExternalIdorder by t.tr_volgnummer descfetch first ~31 rows only"
316670983,,".1","CheckExportPostAction booked","select 1 from tap_tr_rel_account_info traiinner join ips_instell_per_rek i on                                i.ips_re_id = trai.trai_tr_re_idinner join transactions t on                        t.tr_volgnummer = trai.trai_tr_volgnummerleft outer join trans_export te on                              te.te_tr_volgnummer = trai.trai_tr_volgnummer and                              te.te_re_id         = trai.trai_tr_re_id and                             te.te_exportsoort  = ~1left outer join tap_post_action_batch b on b.post_action = 128 and b.tr_id = t.tr_volgnummerleft outer join bank_cash_balance_mutations bcm ON                                             bcm.transaction_id = trai.trai_tr_volgnummer AND                                             bcm.account_id     = trai.trai_tr_re_idleft outer join positiemutaties_geld        pmg ON                                             pmg.pmg_tr_volgnummer = trai.trai_tr_volgnummer AND                                            pmg.pmg_re_id         = trai.trai_tr_re_idwhere(:2 = 0 or i.ips_relatienummer >=  ~2 )AND (:3 = 0 or i.ips_relatienummer <=  ~3 )AND (:4 = 0 or i.ips_totaliseren >= ~4 )AND (:5 = 0 or i.ips_totaliseren <= ~5 )AND i.ips_exac_id IS NOT NULLAND i.ips_nostro_exac_id IS NOT NULL AND te.te_tr_volgnummer IS NULLAND b.tr_id IS NULLAND nvl(bcm.amount, 0) + nvl(pmg.pmg_mutatie_aantal, 0) <> 0AND t.tr_indicatie NOT IN ( 'LOSB', 'TOEK', 'YTD')AND ( t.tr_transnummer > i.ips_lst_transactienummer OR t.tr_boekdatum > i.ips_datum_lst_export)fetch first row only"
316670983,,".2","CheckExportPostAction not booked","select 1 from transactions t            INNER JOIN tap_tr_rel_account_info     ai1 ON ai1.trai_tr_volgnummer = t.tr_volgnummer            INNER JOIN ips_instell_per_rek         i ON i.ips_re_id = ai1.trai_tr_re_id                                                AND i.ips_exac_id IS NOT NULL                                                AND i.ips_nostro_exac_id IS NOT NULL            LEFT OUTER JOIN bank_cash_balance_mutations m ON m.transaction_id = t.tr_volgnummer                                                             AND m.account_id = i.ips_re_id            LEFT OUTER JOIN positiemutaties_geld        pmg ON pmg.pmg_tr_volgnummer = t.tr_volgnummer                                                        AND pmg.pmg_re_id = i.ips_re_id        WHERE         -- only transactions not booked                    t.tr_transnummer = 0            AND (:1 = 0 or i.ips_relatienummer >=  ~1 )            AND (:2 = 0 or i.ips_relatienummer <=  ~2 )            AND (:3 = 0 or i.ips_totaliseren >= ~3  )            AND (:4 = 0 or i.ips_totaliseren <= ~4  )            AND t.tr_indicatie NOT IN ( 'LOSB', 'TOEK', 'YTD' )        -- and in the post action the GIOM export (bit 8, value  128) indicator was NOT set            AND bitand(128, t.tr_tpc_post_actions) = 0            AND nvl(m.amount, 0) + nvl(pmg.pmg_mutatie_aantal, 0) <> 0            fetch first row only"
316670983,,".3","CheckExportNotPostAction","-- Check if transactions will unintentionally be included in the GIOM export when switching to the NOT post action variant.-- A record will be found when a transaction will be included.SELECT    1FROM    dualWHERE    EXISTS (--check 'booked' transactions		SELECT			1		FROM            ips_instell_per_rek i        INNER JOIN tap_tr_rel_account_info ai1 			ON ai1.trai_tr_re_id = i.ips_re_id        INNER JOIN transactions t 			ON t.tr_volgnummer = ai1.trai_tr_volgnummer        LEFT OUTER JOIN bank_cash_balance_mutations m 			ON m.transaction_id = t.tr_volgnummer            AND m.account_id = i.ips_re_id        LEFT OUTER JOIN positiemutaties_geld pmg 			ON pmg.pmg_tr_volgnummer = t.tr_volgnummer            AND pmg.pmg_re_id = i.ips_re_id        LEFT OUTER JOIN transactionhistory th 			ON th.tr_id = t.tr_volgnummer 			AND th.trhi_state='EXPORTED_GIOM'        WHERE			i.ips_exac_id IS NOT NULL			AND (:2 = 0 OR i.ips_relatienummer >=  ~2 )			AND (:3 = 0 OR i.ips_relatienummer <=  ~3 )			AND (:4 = 0 OR i.ips_totaliseren >= ~4  )			AND (:5 = 0 OR i.ips_totaliseren <= ~5  )			AND i.ips_nostro_exac_id IS NOT NULL  			AND ( t.tr_boekdatum >= i.ips_datum_lst_export OR t.tr_transnummer > i.ips_lst_transactienummer )			AND t.tr_indicatie NOT IN ( 'LOSB', 'TOEK', 'YTD' )			--transaction already exported via post action			AND th.tr_id IS NOT NULL			AND nvl(m.amount, 0) + nvl(pmg.pmg_mutatie_aantal, 0) <> 0			AND NOT EXISTS (SELECT 1 FROM trans_export te WHERE te_exportsoort =  ~1 AND te_tr_volgnummer = tr_volgnummer AND te.te_re_id = ai1.trai_tr_re_id)			AND NOT EXISTS (SELECT 1 FROM tv_transactions_in_progress trip WHERE trip.trip_tr_volgnummer = ai1.trai_tr_volgnummer)        FETCH FIRST ROW ONLY    )"
